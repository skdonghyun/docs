import lunr from 'lunr';

class LunrSearchAdapter {
  constructor(searchDocs, searchIndex) {
    this.searchDocs = searchDocs;
    this.lunrIndex = lunr.Index.load(searchIndex);
  }

  search(query) {
    const results = this.lunrIndex.search(query);
    return results.map(result => {
      const doc = this.searchDocs[result.ref];
      return {
        system: doc.url.split('/')[1] || 'General',
        hierarchy: {
          lvl0: doc.title,
          lvl1: doc.headers && doc.headers.length > 0 ? doc.headers[0] : null,
        },
        url: doc.url,
        _snippetResult: {
          content: {
            value: doc.content.substring(0, 200) + '...',
          },
        },
      };
    });
  }
}

export default LunrSearchAdapter;